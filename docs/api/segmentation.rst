Semantic segmentation
=====================
.. automodule:: remote_sensing_processor.segmentation
   :members: generate_tiles, train, test, generate_map
   :show-inheritance:
   
List of available NN models
---------------------------

+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| Model           | Backbone           | Classification | Regression | No metrics-related freeze issues  | No convergence issues  | Fine-tuning available  | Reference                                                                                                                                         |
+=================+====================+================+============+===================================+========================+========================+===================================================================================================================================================+
| BEiT            |                    | \+             | \-[4]_     | \+                                | \+                     | \+                     | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/beit>`_                                                     |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| ConditionalDETR |                    | \+             | \+         | \+-[1]_                           | \+                     | Not tested             | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/conditional_detr>`_                                         |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| Data2Vec        |                    | \+             | -[4]_      | \+                                | \+                     | \+                     | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/data2vec>`_                                                 |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| DETR            |                    | \+             | \+         | \+-[1]_                           | \+                     | \+                     | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/detr>`_                                                     |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| DPT             |                    | \+             | \-[4]_     | \+                                | \+                     | \+                     | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/dpt>`_                                                      |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| Mask2Former     |                    | \+             | \-[4]_     | \+-[1]_                           | \+-[2]_                | \+                     | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/mask2former>`_                                              |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| MaskFormer      |                    | \+             | \-[4]_     | \+                                | \+-[2]_                | \                      | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/maskformer>`_                                               |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| MobileNetV2     |                    | \+             | \+         | \+                                | \+                     | \+                     | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/mobilenet_v2>`_                                             |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| MobileViT       |                    | \+             | \+         | \+                                | \+                     | \+                     | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/mobilevit>`_                                                |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| MobileViTV2     |                    | \+             | \+         | \+                                | \+                     | \+                     | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/mobilevitv2>`_                                              |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| OneFormer       | Swin               | \+             | \-[4]_     | \+-[1]_                           | \+-[2]_                | \+                     | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/oneformer>`_                                                |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | ConvNeXT           | \+             | \-[4]_     | \+-[1]_                           | \+-[2]_                | Not tested             |                                                                                                                                                   |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | ConvNeXTV2         | \+             | \-[4]_     | \+-[1]_                           | \+-[2]_                | Not tested             |                                                                                                                                                   |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | DiNAT              | \-[3]_         | \-[3]_     |                                   |                        |                        |                                                                                                                                                   |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| SegFormer       |                    | \+             | \-[4]_     | \+                                | \+                     | \+                     | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/segformer>`_                                                |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| UperNet         | Swin               | \+             | \-[4]_     | \+                                | \+                     | \+                     | `Huggingface Transformers <https://huggingface.co/docs/transformers/main/en/model_doc/upernet>`_                                                  |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | ResNet             | \+             | \+         | \+                                | \+                     | Not tested             |                                                                                                                                                   |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | ConvNeXT           | \+             | \+         | \+                                | \+                     | \+                     |                                                                                                                                                   |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | ConvNeXTV2         | \+             | \+         | \+                                | \+                     | Not tested             |                                                                                                                                                   |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| DeepLabV3       | MobileNet_V3_Large | \+             | \+         | \+                                | \+                     | \+                     | `Torchvision <https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.deeplabv3_mobilenet_v3_large.html>`_             |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
|                 | ResNet50           | \+             | \+         | \+                                | \+                     | \+                     | `Torchvision <https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.deeplabv3_resnet50.html>`_                       |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
|                 | ResNet101          | \+             | \+         | \+                                | \+                     | \+                     | `Torchvision <https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.deeplabv3_resnet101.html>`_                      |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| FCN             | ResNet50           | \+             | \+         | \+                                | \+                     | \+                     | `Torchvision <https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.fcn_resnet50.html>`_                             |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
|                 | ResNet101          | \+             | \+         | \+                                | \+                     | \+                     | `Torchvision <https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.fcn_resnet101.html>`_                            |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| LRASPP          |                    | \+             | \+         | \+                                | \+                     | \+                     | `Torchvision <https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.lraspp_mobilenet_v3_large.html>`_                |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+


You can fine-tune pre-trained model by defining ``weights``. For models from Transformers you can get available weights from `Huggingface Hub <https://huggingface.co/models?pipeline_tag=image-segmentation&sort=downloads>`_, for Torchvision models you just set ``weights = True``.

``rsp.segmentation.train`` also saves CSV and Tensorboard logs in directory where checkpoint file is saved.



List of available Scikit-learn models
-------------------------------------

+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Model                 | Kernel/solver [5]_ | Classification | Regression | Warm start | Reference                                                                                                                                   |
+=======================+====================+================+============+============+=============================================================================================================================================+
| Nearest Neighbors     |                    | \+             | \+         | \-         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.KNeighborsClassifier.html>`_                             |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Logistic Regression   | lbfgs              | \+             | \-         | \+         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html>`_                            |
+                       +--------------------+----------------+------------+------------+                                                                                                                                             +
|                       | liblinear          | \+             | \-         | \-         |                                                                                                                                             |
+                       +--------------------+----------------+------------+------------+                                                                                                                                             +
|                       | newton-cg          | \+             | \-         | \+         |                                                                                                                                             |
+                       +--------------------+----------------+------------+------------+                                                                                                                                             +
|                       | newton-cholesky    | \+             | \-         | \+         |                                                                                                                                             |
+                       +--------------------+----------------+------------+------------+                                                                                                                                             +
|                       | sag                | \+             | \-         | \+         |                                                                                                                                             |
+                       +--------------------+----------------+------------+------------+                                                                                                                                             +
|                       | saga               | \+             | \-         | \+         |                                                                                                                                             |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Ridge                 |                    | \-             | \+         | \-         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Ridge.html>`_                                         |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Lasso                 |                    | \-             | \+         | \-         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Lasso.html>`_                                         |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| ElasticNet            |                    | \-             | \+         | \-         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.ElasticNet.html>`_                                    |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| SVM                   | rbf                | \+             | \+         | \-         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html>`_                                                    |
+                       +--------------------+----------------+------------+------------+                                                                                                                                             +
|                       | linear             | \+             | \+         | \-         |                                                                                                                                             |
+                       +--------------------+----------------+------------+------------+                                                                                                                                             +
|                       | poly               | \+             | \+         | \-         |                                                                                                                                             |
+                       +--------------------+----------------+------------+------------+                                                                                                                                             +
|                       | sigmoid            | \+             | \+         | \-         |                                                                                                                                             |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Gaussian Process      |                    | \+             | \+         | \+         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.gaussian_process.GaussianProcessClassifier.html>`_                 |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Naive Bayes           |                    | \+             | \-         | \-         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.naive_bayes.GaussianNB.html>`_                                     |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| QDA                   |                    | \+             | \-         | \-         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.discriminant_analysis.QuadraticDiscriminantAnalysis.html>`_        |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Decision Tree         |                    | \+             | \+         | \-         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html>`_                                |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Random Forest         |                    | \+             | \+         | \+         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html>`_                            |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| AdaBoost              |                    | \+             | \+         | \-         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.AdaBoostClassifier.html>`_                                |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Gradient Boosting     |                    | \+             | \+         | \+         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.HistGradientBoostingClassifier.html>`_                    |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Multilayer Perceptron |                    | \+             | \+         | \+         | `Scikit-learn <https://scikit-learn.org/stable/modules/generated/sklearn.neural_network.MLPClassifier.html>`_                               |
+-----------------------+--------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+

Models that support warm start can be fine-tuned using pre-trained models with ``checkpoint`` argument.

Some models can have issues while saving, especially when trained on big datasets. Some models (like SVM) can train for a very long time or (like Gaussian process) can have memory issues with big datasets. So we recommend using Scikit-learn models only for small datasets.

.. [1] These models can freeze forever on one of first steps. It happens due to some confusion matrix-based metrics related error. Try to restart training with ``less_metrics = True``.

.. [2] These models showed very poor performance on tests. They only converged slowly with ``lr=1e-5``, but much more slow than other models. I do not recommend using them.

.. [3] DiNAT requires ``natten`` library, that is not available on Windows and Mac and not available via Conda. RSP supports DiNAT backbone, but you need to install ``natten`` in your python env manually.

.. [4] Loss becomes ``nan`` while training several transformers if the task is regression.

.. [5] Is defined with ``backbone`` argument.