Semantic segmentation
=====================
.. automodule:: remote_sensing_processor.segmentation
   :members: generate_tiles, train, test, generate_map
   :show-inheritance:
   
List of available NN models
===========================

+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| Model           | Backbone           | Classification | Regression | No metrics-related freeze issues  | No convergence issues  | Fine-tuning available  | Reference                                                                                                                                         |
+=================+====================+================+============+===================================+========================+========================+===================================================================================================================================================+
| BEiT            |                    | \+             | \-[4]_     | \+                                | \+                     | \+                     | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/beit>Huggingface Transformers</a>                                              |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| ConditionalDETR |                    | \+             | \+         | \+-[1]_                           | \+                     | Not tested             | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/conditional_detr>Huggingface Transformers</a>                                  |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| Data2Vec        |                    | \+             | -[4]_      | \+                                | \+                     | \+                     | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/data2vec>Huggingface Transformers</a>                                          |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| DETR            |                    | \+             | \+         | \+-[1]_                           | \+                     | \+                     | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/detr>Huggingface Transformers</a>                                              |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| DPT             |                    | \+             | \-[4]_     | \+                                | \+                     | \+                     | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/dpt>Huggingface Transformers</a>                                               |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| Mask2Former     |                    | \+             | \-[4]_     | \+-[1]_                           | \+-[2]_                | \+                     | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/mask2former>Huggingface Transformers</a>                                       |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| MaskFormer      |                    | \+             | \-[4]_     | \+                                | \+-[2]_                | \                      | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/maskformer>Huggingface Transformers</a>                                        |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| MobileNetV2     |                    | \+             | \+         | \+                                | \+                     | \+                     | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/mobilenet_v2>Huggingface Transformers</a>                                      |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| MobileViT       |                    | \+             | \+         | \+                                | \+                     | \+                     | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/mobilevit>Huggingface Transformers</a>                                         |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| MobileViTV2     |                    | \+             | \+         | \+                                | \+                     | \+                     | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/mobilevitv2>Huggingface Transformers</a>                                       |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| OneFormer       | Swin               | \+             | \-[4]_     | \+-[1]_                           | \+-[2]_                | \+                     | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/oneformer>Huggingface Transformers</a>                                         |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | ConvNeXT           | \+             | \-[4]_     | \+-[1]_                           | \+-[2]_                | Not tested             |                                                                                                                                                   |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | ConvNeXTV2         | \+             | \-[4]_     | \+-[1]_                           | \+-[2]_                | Not tested             |                                                                                                                                                   |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | DiNAT              | \-[3]_         | \-[3]_     |                                   |                        |                        |                                                                                                                                                   |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| SegFormer       |                    | \+             | \-[4]_     | \+                                | \+                     | \+                     | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/segformer>Huggingface Transformers</a>                                         |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| UperNet         | Swin               | \+             | \-[4]_     | \+                                | \+                     | \+                     | <a href=https://huggingface.co/docs/transformers/main/en/model_doc/upernet>Huggingface Transformers</a>                                           |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | ResNet             | \+             | \+         | \+                                | \+                     | Not tested             |                                                                                                                                                   |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | ConvNeXT           | \+             | \+         | \+                                | \+                     | \+                     |                                                                                                                                                   |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+                                                                                                                                                   +
|                 | ConvNeXTV2         | \+             | \+         | \+                                | \+                     | Not tested             |                                                                                                                                                   |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| DeepLabV3       | MobileNet_V3_Large | \+             | \+         | \+                                | \+                     | \+                     | <a href=https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.deeplabv3_mobilenet_v3_large.html>Torchvision</a>      |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
|                 | ResNet50           | \+             | \+         | \+                                | \+                     | \+                     | <a href=https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.deeplabv3_resnet50.html>Torchvision</a>                |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
|                 | ResNet101          | \+             | \+         | \+                                | \+                     | \+                     | <a href=https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.deeplabv3_resnet101.html>Torchvision</a>               |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| FCN             | ResNet50           | \+             | \+         | \+                                | \+                     | \+                     | <a href=https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.fcn_resnet50.html>Torchvision</a>                      |
+                 +--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
|                 | ResNet101          | \+             | \+         | \+                                | \+                     | \+                     | <a href=https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.fcn_resnet101.html>Torchvision</a>                     |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+
| LRASPP          |                    | \+             | \+         | \+                                | \+                     | \+                     | <a href=https://pytorch.org/vision/stable/models/generated/torchvision.models.segmentation.lraspp_mobilenet_v3_large.html>Torchvision</a>         |
+-----------------+--------------------+----------------+------------+-----------------------------------+------------------------+------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------+


You can fine-tune pre-trained model by defining `weights`. For models from Transformers you can get available weights from [Huggingface Hub](https://huggingface.co/models?pipeline_tag=image-segmentation&sort=downloads), for Torchvision models you just set `weights = True`.

`rsp.segmentation.train` also saves CSV and Tensorboard logs in directory where checkpoint file is saved.



List of available Scikit-learn models
=====================================

+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Model                 | Kernel/solver[5]_ | Classification | Regression | Warm start | Reference                                                                                                                                   |
+=======================+===================+================+============+============+=============================================================================================================================================+
| Nearest Neighbors     |                   | \+             | \+         | \-         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.neighbors.KNeighborsClassifier.html>Scikit-learn</a>                      |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Logistic Regression   | lbfgs             | \+             | \-         | \+         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LogisticRegression.html>Scikit-learn</a>                     |
+                       +-------------------+----------------+------------+------------+                                                                                                                                             +
|                       | liblinear         | \+             | \-         | \-         |                                                                                                                                             |
+                       +-------------------+----------------+------------+------------+                                                                                                                                             +
|                       | newton-cg         | \+             | \-         | \+         |                                                                                                                                             |
+                       +-------------------+----------------+------------+------------+                                                                                                                                             +
|                       | newton-cholesky   | \+             | \-         | \+         |                                                                                                                                             |
+                       +-------------------+----------------+------------+------------+                                                                                                                                             +
|                       | sag               | \+             | \-         | \+         |                                                                                                                                             |
+                       +-------------------+----------------+------------+------------+                                                                                                                                             +
|                       | saga              | \+             | \-         | \+         |                                                                                                                                             |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Ridge                 |                   | \-             | \+         | \-         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Ridge.html>Scikit-learn</a>                                  |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Lasso                 |                   | \-             | \+         | \-         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Lasso.html>Scikit-learn</a>                                  |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| ElasticNet            |                   | \-             | \+         | \-         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.ElasticNet.html>Scikit-learn</a>                             |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| SVM                   | rbf               | \+             | \+         | \-         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.svm.SVC.html>Scikit-learn</a>                                             |
+                       +-------------------+----------------+------------+------------+                                                                                                                                             +
|                       | linear            | \+             | \+         | \-         |                                                                                                                                             |
+                       +-------------------+----------------+------------+------------+                                                                                                                                             +
|                       | poly              | \+             | \+         | \-         |                                                                                                                                             |
+                       +-------------------+----------------+------------+------------+                                                                                                                                             +
|                       | sigmoid           | \+             | \+         | \-         |                                                                                                                                             |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Gaussian Process      |                   | \+             | \+         | \+         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.gaussian_process.GaussianProcessClassifier.html>Scikit-learn</a>          |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Naive Bayes           |                   | \+             | \-         | \-         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.naive_bayes.GaussianNB.html>Scikit-learn</a>                              |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| QDA                   |                   | \+             | \-         | \-         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.discriminant_analysis.QuadraticDiscriminantAnalysis.html>Scikit-learn</a> |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Decision Tree         |                   | \+             | \+         | \-         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.tree.DecisionTreeClassifier.html>Scikit-learn</a>                         |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Random Forest         |                   | \+             | \+         | \+         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.RandomForestClassifier.html>Scikit-learn</a>                     |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| AdaBoost              |                   | \+             | \+         | \-         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.AdaBoostClassifier.html>Scikit-learn</a>                         |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Gradient Boosting     |                   | \+             | \+         | \+         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.HistGradientBoostingClassifier.html>Scikit-learn</a>             |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+
| Multilayer Perceptron |                   | \+             | \+         | \+         | <a href=https://scikit-learn.org/stable/modules/generated/sklearn.neural_network.MLPClassifier.html>Scikit-learn</a>                        |
+-----------------------+-------------------+----------------+------------+------------+---------------------------------------------------------------------------------------------------------------------------------------------+

Models that support warm start can be fine-tuned using pre-trained models with `checkpoint` arg.

Some models can have issues while saving, especially when trained on big datasets. Some models (like SVM) can train for a very long time or (like Gaussian process) can have memory issues with big datasets. So we recommend using Scikit-learn models only for small datasets.

.. [1] These models can freeze forever on one of first steps. It happens due to some confusion matrix-based metrics related error. Try to restart training with `less_metrics = True`.

.. [2] These models showed very poor performance on tests. They only converged slowly with `lr=1e-5`, but much more slow than other models. I do not recommend using them.

.. [3] DiNAT requires `natten` library, that is not available on Windows and Mac and not available via Conda. RSP supports DiNAT backbone, but you need to install `natten` in your python env manually.

.. [4] Loss becomes `nan` while training several transformers if the task is regression.

.. [5] Is defined with `backbone`.